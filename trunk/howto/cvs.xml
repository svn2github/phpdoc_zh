<?xml version="1.0" encoding="gb2312"?>
<!-- $Revision: 1.4 $ -->
<!-- $AUTHOR$ -->
<!-- EN-Revision: 1.4 Maintainer: Gregory Status: ready -->

 <chapter id="chapter-cvs">
  <title>利用 CVS 开展工作</title>

  <para>
   PHP 文档的维护工作是借助 <ulink
   url="&url.cvs;">CVS</ulink> (<emphasis>Concurrent
   Versions System</emphasis>，版本协调系统)来完成的。CVS 的使用让文档工作者在不需要等待
   其他人的工作的情况下同时更新 PHP 文档不同的文件。
  </para>
  
  <para>
   一个 CVS 系统包含有一个存有所有文件的中央服务器。一个 CVS 服务器可以作为许多不同的资源库
   的服务器，PHP 文档资源库的名称是 <literal>phpdoc</literal>。要访问该服务器，您需要在
   您的系统上安装一个 CVS 的客户端程序。
  </para>
  
  <para>
   当您决定开始要对一个文件开展工作时，您需要先校验（即下载）该文件。然后才能在您下载的文件的
   基础上进行修改。当您完成后，您需要提交您所做的修改，即上传该文件。CVS 客户端程序会要求您
   输入简短的注释，您可以在这里输入您所做的修改的概括性描述。CVS 服务器将储存所有更新过的文件
   的历史记录，包括它们所附带的注释。这样，其他人就能够知道您对那个文件作了哪些修改，因为在您
   向 CVS 服务器提交您的结果时，系统会自动比较最新版本和上一个版本的差别，并将其内容自动发送
   到 <link linkend="chapter-maillist">邮件列表</link>，其结果可以通过 CVS 客户端来查
   看，或者通过 WEB 界面：<ulink url="&url.php.cvs;">&url.php.cvs;</ulink>。您同样可
   以根据需要利用您的 CVS 客户端在 CVS 服务器上删除或者增添文件。
  </para>

  <para>
   本节内容并非希望成为 CVS 使用指南，仅仅只是引导您能够尽快的学会下载 <literal>phpdoc</literal> 
   目录树以及提交您的更新。如果您需要 CVS 完整的文档，请查阅 <ulink url="&url.cvs;">&url.cvs;</ulink>。
  </para>

  <para>
   CVS 使用指南可以在以下地址找到：
   <itemizedlist>
    <listitem>
     <simpara><ulink url="&url.cvstut1;">&url.cvstut1;</ulink></simpara>
    </listitem>
    <listitem>
     <simpara><ulink url="&url.cvstut2;">&url.cvstut2;</ulink></simpara>
    </listitem>
   </itemizedlist>
  </para>
  
  <para>
   您也可以随时在您的 CVS 客户端中使用 <literal>man cvs</literal> 命令来获取帮助。使用该命令
   将得到被称为“manpage”的帮助文档。
  </para>

  <sect1 id="cvs-account">
   <title>如何获取 CVS 账号</title>
   
   <para>
    首先，在您能够进行文档有关工作之前，您需要先访问 <ulink url="&url.php.cvs;">
    cvs.php.net</ulink> 的资源库。您随时都可以以匿名的方式下载资源库中的模块，但是要上传文件则必须
    有 CVS 账号。如果您仅需要下载文件，您可以使用只读的账号和密码。请查阅 
    <ulink url="&url.php.anoncvs;">&url.php.anoncvs;</ulink> 以获取更多信息。
   </para>

   <para>
    同时也请注意，即使您在我们的服务端有 CVS 的账号，您也可能没有 <literal>phpdoc</literal> 
    模块的写权限。我们的 Karma 系统控制着不同的账号访问不同资源库的权限，所以如果您有 CVS 
    账号，但是没有访问 <literal>phpdoc</literal>的 Karma 权限，请向 Karma <ulink 
    url="mailto:&email.group.php;">&email.group.php;</ulink> 垂询。注意，有 PHP 源
    码目录树 Karma 写权限的人，同样也有 <literal>phpdoc</literal> 的 Karma 权限。
   </para>

   <para>
    在 php.net 获取一个 CVS 账号并不困难，您只需完成以下两件事：
    <itemizedlist>
     <listitem>
      <simpara>
       用英文向 <ulink url="mailto:&email.group.php;">&email.group.php;</ulink>发
       送电子邮件，说明您希望利用 CVS 账号来做些什么（即参与 PHP 文档的维护工作）。同时也请
       付上您的一些个人信息和背景等以便开发人员了解您来自何处。
      </simpara>
     </listitem>
     <listitem>
      <simpara>
       一旦开发小组回应了您的电子邮件，您需要访问 <ulink
       url="&url.php.cvsaccount;">&url.php.cvsaccount;</ulink> 来填写正式的注册表单。
      </simpara>
     </listitem>

    </itemizedlist>
   </para>

   <para>
    以上两个步骤以及和所有 cvs.php.net 的 CVS 账号有关的信息，都可以在注册表单所在的网页找
    到。其地址为 <ulink url="&url.php.cvsaccount;">&url.php.cvsaccount;</ulink>。注
    意，利用该注册表单注册并非是自动处理的过程。如果您在提交表单后的几天内没有收到任何回应，请
    别忘了再次提交您的申请。
   </para>

  </sect1> 

  <sect1 id="cvs-login">
   <title>CVS 的登录</title>
   <para>
    现在您已经有 CVS 资源库的写权限了，我们还需要在您的 <filename>.cvsrc</filename> 加上
    一些变量。例如增加 <literal>CVSROOT</literal> 环境变量以便登录 CVS 资源库。
   </para>

   <para>
    如果在您的根目录中尚无 <filename>.cvsrc</filename> 文件，那么请建立该文件并加入以下几
    行内容。注意如果您使用的是 Cygwin，您的根目录即是您运行 bash 外壳时最先打开的目录（即 
    Cygwin 安装目录下的 home/username目录）。
    <informalexample>
     <programlisting>
cvs -z3
update -d -P
checkout -P
diff -u
     </programlisting>
    </informalexample>
   </para>

   <para>
    每次您向 CVS 资源库提交要执行的操作时，都需要以如下方式指明资源库的 cvs 根目录：
    <informalexample>
     <programlisting>
$ cvs -d :pserver:<parameter>username</parameter>@cvs.php.net:/repository checkout <parameter>phpdoc</parameter>
     </programlisting>
    </informalexample>
   </para>

   <para>
    您可以设置 CVSROOT 环境变量，以免每次向资源库执行命令时都要指明其根目录。
   </para>

   <para>
    对于 <literal>sh</literal> 和 <literal>bash</literal> 的用户，请将下列内容加入到
    您的 <filename>.bashrc</filename> 或者 <filename>.profile</filename> 文件中。
    <informalexample>
     <programlisting>
CVSROOT=:pserver:<parameter>username</parameter>@cvs.php.net:/repository
export CVSROOT
     </programlisting>
    </informalexample>
   </para>

   <para>
    对于 <literal>csh</literal> 和 <literal>tcsh</literal> 的用户，请将下列内容加入到
    您的 <filename>.cshrc</filename> 或者 <filename>.tcshrc</filename> 文件中.
    <informalexample>
     <programlisting>
setenv CVSROOT :pserver:<parameter>username</parameter>@cvs.php.net:/repository
     </programlisting>
    </informalexample>
   </para>

   <note>
    <para>
     <literal>CVSROOT</literal> 环境变量仅在您下次登录的时候才会生效。
    </para>
   </note>
   
   <para>
    如果您使用的是 Windows 系统，请用您通常的方法添加环境变量。在 Windows 9x 系统下，使
    用 <command>set</command> 命令，在 Windows 2000 系统下使用环境变量的设置对话框。
   </para>

   <para>
    您已经完成了所有的准备工作，请使用如下命令登录到 CVS 资源库：
    <informalexample>
     <programlisting>
$ cvs login
     </programlisting>
    </informalexample>
   </para>

   <para>
    或者，如果您还没有设置 <literal>CVSROOT</literal> 环境变量，为了保证您访问了正确的 
    CVS 资源库，请使用如下命令：
    <informalexample>
     <programlisting>
$ cvs -d :pserver:<parameter>username</parameter>@cvs.php.net:/repository login
     </programlisting>
    </informalexample>
   </para>

   <para>
    请将以上命令行中的 <parameter>username</parameter> 替换成您自己的 CVS 用户名。您将
    被要求提供您的密码。一旦您成功的登录到了 CVS 资源库，您的密码将被加密后保存在您的根目录
    的 <filename>.cvspass</filename> 文件中，这样，您以后就不用每次提交命令前都要进行登
    录操作，除非您删除了该文件，或者执行了 <literal>cvs logout</literal> 命令。
   </para>

  </sect1>

  <sect1 id="cvs-checkout">
   <title>模块校验</title> 

   <para>
    现在，您可以校验（即下载）<parameter>phpdoc</parameter> 模块了。所谓模块，是指一系列
    的源文档以及目录，通常它们就是 CVS 资源库的一个子目录。
   </para>

   <para>
    用 <command>cd</command> 命令切换到您希望用来储存 <literal>phpdoc</literal> 模块
    的目录，执行以下命令，将在该目录下建立一个名为 <filename>phpdoc</filename> 的子目录:
    <informalexample>
     <programlisting>
$ cvs checkout <parameter>phpdoc</parameter>
     </programlisting>
    </informalexample>
   </para>

   <para>
    当系统显示完一些校验命令的回显信息后，您就应该已经拥有了一个完整的 
    <literal>phpdoc</literal> 模块了。
   </para>

   <note>
    <para>
     在决定将 <filename>phpdoc</filename> 目录放在哪里的问题上，您并非是完全自由的。请查
     阅“<link linkend="chapter-tools">工具及安装须知</link>”一节以获更准确的信息来确认
     该 <filename>phpdoc</filename> 目录在您的系统中是否受到限制。
    </para>
   </note>
   
  </sect1>

  <sect1 id="cvs-update">
   <title>更新目录树</title> 

   <para>
    我们建议您随时更新您的 <parameter>phpdoc</parameter> 目录树以保证您拥有最新的文件。
    目前，该目录下的内容几乎每天都有更新，因此，在您进行编辑工作之前，请一定要先更新您的文件。
   </para>

   <para>
    要更新您的文件，请用 <command>cd</command> 切换到 <filename>phpdoc</filename> 目
    录并运行如下命令：
    <informalexample>
     <programlisting>
$ cvs update
     </programlisting>
    </informalexample>
   </para>

   <para>
    如果您仅希望更新一个或某一些您需要更改的文件，您可以在 update 命令后面加加上它们的文件名：
    <informalexample>
     <programlisting>
$ cvs update <parameter>file1</parameter> <optional><parameter>file2</parameter></optional>
     </programlisting>
    </informalexample>
   </para>

   <para>
    如果这些文件不在 <filename>phpdoc</filename> 的根目录下，请加上这些文件的相对路径：
    <informalexample>
     <programlisting>
$ cvs update <parameter>en/functions/file1</parameter> <optional><parameter>en/chapters/file2</parameter></optional>
     </programlisting>
    </informalexample>
   </para>

  </sect1>

  <sect1 id="cvs-status">
   <title>检查文件的状态</title>

   <para>
    如果您已经对您本地的 <literal>phpdoc</literal> 文件做了一些更改并希望了解哪些文件被做
    了修改，您可以向 <command>cvs</command> 获取这些文件的当前状态。
   </para>

   <para>
    运行以下命令以获取当前目录下所有文件的状态：
    <informalexample>
     <programlisting>
$ cvs status -l
     </programlisting>
    </informalexample>
   </para>

   <para>
    该命令通常都会生成一个庞大的列表，您可以在检查文件状态时加上需要的文件名：
    <informalexample>
     <programlisting>
$ cvs status <parameter>file1</parameter> <optional><parameter>file2</parameter></optional>
     </programlisting>
    </informalexample>
   </para>

   <para>
    <example>
     <title><command>cvs status</command> 命令范例</title>
     <screen>
$ cvs status -l phpdoc/howto/howto.xml     
===================================================================
File: howto.xml         Status: Locally Modified

   Working revision:    1.6
   Repository revision: 1.6     /repository/phpdoc/howto/howto.xml,v
   Sticky Tag:          (none)
   Sticky Date:         (none)
   Sticky Options:      (none)
     </screen>
    </example>
   </para>

  </sect1>

  <sect1 id="cvs-commit">
   <title>提交更新</title> 

   <para>
    一旦您完成了对一个文件的更改，并<emphasis>已使您的 XML 文件生效 (validated)</emphasis>，
    您就可以向 CVS 资源库提交您所做的更新。
   </para>

   <para>
    在向资源库提交文件时，给您所做的更新作一个简短的注释是最基本的礼貌。您无需写明您所做的所有
    修改，这是 CVS 系统本身工作的一部分，但是您所做的注释有利于帮助工作人员在文档被更新后不查看
    源文档就能知道该文档被做了那些修改。
   </para>

   <para>
    请运行以下命令提交文件：
    <informalexample>
     <programlisting>
$ cvs commit -m 'added new blah() function' <parameter>file1</parameter> <optional><parameter>file2</parameter></optional>
     </programlisting>
    </informalexample>
   </para>
   
   <para>
    有时去掉 <parameter>-m</parameter> 参数会更方便一些，因为这样 CVS 将会打开一个文本
    编辑器来让你输入您的注释。当您希望添加更多的注释，并发觉无法用 
    <parameter>-m</parameter> 参数将这些注释写在一行里时，您便可以使用这种方式。
   </para>
  </sect1>

  <sect1 id="cvs-add">
   <title>新增文件或目录</title> 

   <para>
    有的时候您可以在原英文版本的基础上添加新的文件（如增添新的附录），这也是翻译工作最初需要
    进行的工作（新增已翻译的文件）。要新增一个文件，您需要先把它放在您希望的正确的位置。
   </para>

   <para>
    请运行以下命令新增一个文件：
    <informalexample>
     <programlisting>
$ cvs add <parameter>file1</parameter> <optional><parameter>file2</parameter></optional>
     </programlisting>
    </informalexample>
   </para>
   
   <para>
    该操作只是将文件的添加的命令加入了执行队列，要完成文件添加的操作，如前文所描述的，您需要对
    该文件进行一次提交操作。
   </para>
   
   <warning>
    <para>
     在增添新的文件之前，您需要注意给新文件的命名时需要遵循一些由自动文件名到实体名的转化带来
     的规则。
    </para>
   </warning>
  </sect1>

  <sect1 id="cvs-remove">
   <title>删除文件</title> 

   <para>
    该操作在您需要删除 CVS 资源库上的某些文件时执行。CVS 记录有所有文件操作的历史记录，尽管
    删除操作是可撤回的，但有些文件是文档的生成过程所必须的，或者它们存有和其他人相关的重要信
    息，因此，您在删除文件时应该特别慎重。
   </para>

   <para>
    要删除一个文件，首先将该文件从您本地目录中删除，然后执行如下命令：
    <informalexample>
     <programlisting>
$ cvs remove <parameter>file1</parameter> <optional><parameter>file2</parameter></optional>
     </programlisting>
    </informalexample>
   </para>
   
   <para>
    该操作只是将文件的删除命令加入了执行队列。要完成文件的删除操作，如前文所描述的，您需要对
    该文件进行一次提交操作。
   </para>
   
  </sect1>
 </chapter>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"howto.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->

