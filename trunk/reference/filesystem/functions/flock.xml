<?xml version="1.0" encoding="gb2312"?>
<!-- $Revision: 1.3 $ -->
<!-- $Author: dallas $ -->
<!-- EN-Revision: 1.4 Maintainer: lm92 Status: ready -->
  <refentry id="function.flock">
   <refnamediv>
    <refname>flock</refname>
    <refpurpose>轻便的咨询文件锁定</refpurpose>
   </refnamediv>
   <refsect1>
    <title>描述</title>
     <methodsynopsis>
      <type>bool</type><methodname>flock</methodname>
      <methodparam><type>int</type><parameter>fp</parameter></methodparam>
      <methodparam><type>int</type><parameter>operation</parameter></methodparam>
      <methodparam choice="opt"><type>int</type><parameter>&amp;wouldblock</parameter></methodparam>
     </methodsynopsis>
    <simpara>
     PHP 支持以一咨询方式（也就是说所有访问程序必须使用同意方式锁定, 否则它不会工作）锁定全部文件的一种轻便方法。
    </simpara>
    <simpara>
     <function>flock</function> 操作的 <parameter>fp</parameter>
     必须是一个开放的文件指针。
     <parameter>operation</parameter> 可以是以下值之一
     values:
    </simpara>
    <para>
     <itemizedlist>
      <listitem>
       <simpara>
         要设定锁住档案可以允许别的行程读取时，将
         <parameter>operation</parameter> 设为 LOCK_SH （PHP 4.0.1 以前的版本设置为 1）。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
         要设定只有该行程可以写入档案时，将
         <parameter>operation</parameter> 设为 LOCK_EX （PHP 4.0.1 以前的版本中设置为 2）。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
         要设定为读写均锁住时，将
         <parameter>operation</parameter> 设为 LOCK_UN （PHP 4.0.1 以前的版本中设置为 3）。
       </simpara>
      </listitem>
      <listitem>
       <simpara>
         如果你不希望 <function>flock</function> 锁住区块，将
         <parameter>operation</parameter> 设定为 LOCK_NB （PHP 4.0.1 以前的版本中设置为 4）。
       </simpara>
      </listitem>
     </itemizedlist>
    </para>
    <simpara>
     <function>flock</function> 允许你执行一个简单的可以在任何平台中使用的读取/写入模型
     （包括大部分的 Unix 派生版和甚至是 Windows）。如是锁定的是区块（EWOULDBLOCK errno condition）
     请将第三个参数设置为 &true;  。
    </simpara>
    <simpara>
     <function>flock</function> 会在锁定成功后返回 &true; ，如果锁定失败则返回 &false;
     （例如文件不能锁定）。
    </simpara>
    <note>
     <para>
      由于 <function>flock</function> 需要一个文件指针， 因此你可能
      需要一个锁定文件来保护你准备以写模式打开的文件。
      （在 <function>fopen</function> 函数中加入 "w" 或 "w+"）。
     </para>
    </note>
    <warning>
     <para>
      <function>flock</function> 不能在NFS以及其他的一些网络文件系统中正常工作。详细资料请检查你的操作系统文档。
     </para>
     <para>
      在部分操作系统中， <function>flock</function> 以处理级执行。
      当用一个多线程服务器 API（比如 ISAPI）时，
      您可能不可以依靠 <function>flock</function> 来保护文件，
      因为在同一服务器内运行在其它程线的PHP脚本可以对该文件进行处理。
      instance!
     </para>
     <para>
      <function>flock</function> 不支持旧的文件系统，如
      <literal>FAT</literal> 以及它的派生系统。因此，它在这种情况下经常会返回
      一个 &false; 值（尤其是指Windows 98的用户）。
     </para>
    </warning>
   </refsect1>
  </refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
